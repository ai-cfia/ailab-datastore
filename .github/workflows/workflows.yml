---
name: ai-cfia workflows

on:
  pull_request:
    types:
      - opened
      - closed
      - synchronize
jobs:
  get-changed-files:
    name: Get Changed Files
    runs-on: ubuntu-latest
    outputs:
      files: ${{ steps.changed-files.outputs.all_changed_files }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Get Changed Files
        id: changed-files
        uses: tj-actions/changed-files@v45
        with:
          files: |
            nachet/**
            fertiscan/**
  nachet-pyproject-version-bump:
    needs: get-changed-files
    if: contains(needs.get-changed-files.outputs.files, 'nachet/')
    name: nachet-datastore-pyproject-version-bump
    uses: ai-cfia/github-workflows/.github/workflows/workflow-version-bump-python.yml@141-add-optional-checks-in-python-lint-if-the-version-in-pyprojecttoml-file-has-been-bumped-fails-pipeline-if-not-bumped
    secrets: inherit
    with:
      pyproject-path: 'nachet_pyproject.toml'
      package-name: 'nachet-datastore'
  fertiscan-pyproject-version-bump:
    needs: get-changed-files
    if: contains(needs.get-changed-files.outputs.files, 'fertiscan/')
    name: fertiscan-datastore-pyproject-version-bump
    uses: ai-cfia/github-workflows/.github/workflows/workflow-version-bump-python.yml@141-add-optional-checks-in-python-lint-if-the-version-in-pyprojecttoml-file-has-been-bumped-fails-pipeline-if-not-bumped
    secrets: inherit
    with:
      pyproject-path: 'fertiscan_pyproject.toml'
      package-name: 'fertiscan-datastore'
  datastore-lint:
    name: datastore-lint-test-python
    uses: ai-cfia/github-workflows/.github/workflows/workflow-lint-test-python.yml@141-add-optional-checks-in-python-lint-if-the-version-in-pyprojecttoml-file-has-been-bumped-fails-pipeline-if-not-bumped
    secrets: inherit
    with:
      project-path: 'datastore'
      skip-coverage: 'true'
  # bytebase-sql-review:
  #   uses: ai-cfia/github-workflows/.github/workflows/workflow-bytebase-sql-review.yml@main
  #   secrets: inherit
  mkd-check:
    name: workflow-markdown-check
    uses: ai-cfia/github-workflows/.github/workflows/workflow-markdown-check.yml@main
    secrets: inherit
  repo-validation:
    name: workflow-repo-standards-validation
    uses: ai-cfia/github-workflows/.github/workflows/workflow-repo-standards-validation.yml@main
    secrets: inherit
  yaml-check:
    name: workflow-yaml-check
    uses: ai-cfia/github-workflows/.github/workflows/workflow-yaml-check.yml@main
    secrets: inherit
